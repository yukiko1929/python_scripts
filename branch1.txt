code from yuki_branch
